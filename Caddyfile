:80 {
    log {
        output stdout
        format json
    }

    root * /usr/share/caddy

    # 1. 优先处理 API 转发 (强制以 /api 开头)
    handle_path /api/* {
        rewrite * /v1{path}
        reverse_proxy {$BACKEND_ADDR} {
            header_up Host {upstream_hostport}
        }
    }

    # 2. 兜底处理：静态资源和 SPA 路由
    handle {
        try_files {path} /index.html
        file_server
    }
}
